## 9. Передача параметров

Теперь, когда мы ввели явное состояние, вкратце посмотрим на способы передачи параметров. Вы наверняка знакомы с передачей по ссылке и передачей по значению, но было придумано множество других способов передачи информации в вызываемую процедуру и из нее. Это теоретическая и не самая важная тема, с которой всё же желательно ознакомиться.

### Передача по ссылке Call by reference

Идентификатор некоторой языковой сущности передается процедуре. Процедура может свободно использовать эту языковую сущность в своём теле, обращаясь к ней по её идентификатору. Это примитивный механизм, используемый в различных вычислительных моделях на наших курсах, фактически для всех языковых сущностей, включая dataflow-переменные и ячейки.

Но императивные языки часто подразумевают под передачей по ссылке нечто иное. Они предполагают, что ссылка хранится в ячейке, локальной для процедуры -- то есть параметр функции сам по себе локальная переменная в этой функции. В формальной терминологии, это передача по значению, потому что  **сама ссылка рассматривается как значение** . Поэтому рекомендую тщательно изучить, что именно в вашем языке программирования понимается под передачей по ссылке.

### Передача через переменную Call by variable

Это особая версия передачи по ссылке. Идентификатор ячейки передаётся в процедуру, и фактически становится синонимом её имени-параметра внутри процедуры. Отличие от передачи по ссылке в том, что в данном случае в качестве параметра используется не оригинальный идентификатор, а его алиас, однако он -- не локальная переменная внутри функции (в которую копируется ссылка), а скорее синтаксический сахар.

### Передача по значению Call by value

Значение передаётся в процедуру и помещается в ячейку-параметр, локальную в данной процедуре. Реализация может копировать значение целиком или передавать только ссылку, неважно: **формально процедура не может изменять никакие внешние значения в вызывающей среде, за своими пределами, пусть даже они и передаются по ссылке**. 

### Передача по значению-результату Call by value-result

Это версия передачи через переменную, используемая для возврата значения через параметр. Когда процедура вызывается, содержимое ячейки (мутабельная переменная) помещается в другую мутабельную переменную, которая локальна внутри процедуры, над ней выполняются различные внутренние вычисления. Когда процедура завершается, итоговое значение локальной переменной помещается обратно в оригинальную ячейку.

### Передача по имени Call by name

Это наиболее общий случай. Для каждого аргумента создается отдельное процедурное значение -- так называемый  **переходник или преобразователь thunk** . Он вычисляется каждый раз, когда запрашивается аргумент, и фактически возвращает ("вычисляет") имя ячейки -- адрес мутабельной переменной. thunk -- это по сути функция, и например в случае, когда аргументы -- это индексы автоматически выполняющегося цикла, возможны неоднозначные ситуации, связанные с их многократным перевычислением.

### Передача по необходимости Call by need

Это модификация передачи по имени, когда процедурное значение вычисляется только один раз. Аргумент вычисляется, когда запрошен результат, и затем сохраняется в замыкании (в локальной переменной). В последующие обращения к процедуре в качестве аргумента используется уже вычисленное значение из этой локальной переменной. Передача по необходимости фактически работает как ленивое оценивание.

---

На практике программистам конечно вполне удаётся успешно обходиться без учёта нюансов разных видов передач. Например, передача параметра по ссылке -- это примитивный механизм, который лежит в основе других подходов. Он не зависит от дополнительных понятий -- ячейки или процедурного значения, имеет простую формальную семантику и эффективен в реализации. С другой стороны, передача по ссылке далеко не всегда будет правильным выбором, в различных языках например активно поддерживаются схема Call by value-result и иные формы лингвистических абстракций.

*Тестов к этому теоретическому отступлению про параметры не будет* .
